name: üöÄ VS Code Web IDX (Zun Isolation)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian s·ª≠ d·ª•ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  VSCode-Isolation:
    runs-on: ubuntu-latest
    steps:
      - name: üõ†Ô∏è ƒêANG KH·ªûI T·∫†O M√îI TR∆Ø·ªúNG ZUNADMIN
        run: |
          # 1. Thi·∫øt l·∫≠p Hostname Zunadmin
          sudo hostnamectl set-hostname Zunadmin
          echo "127.0.0.1 Zunadmin" | sudo tee -a /etc/hosts > /dev/null

          # 2. T·∫°o ·ªï c·ª©ng ·∫£o 60GB t√™n Zun (S·ª≠a l·ªói Permission denied)
          # T·∫°o ngay t·∫°i home ƒë·ªÉ kh√¥ng b·ªã ch·∫∑n quy·ªÅn
          sudo fallocate -l 60G $HOME/zun_storage.img
          sudo mkfs.ext4 $HOME/zun_storage.img > /dev/null 2>&1
          mkdir -p $HOME/Zun
          sudo mount -o loop $HOME/zun_storage.img $HOME/Zun
          sudo chown $USER:$USER $HOME/Zun

          # 3. C√†i ƒë·∫∑t VS Code Web (Code-Server) ·∫©n danh
          curl -fsSL https://code-server.dev/install.sh | sh > /dev/null 2>&1
          
          # C·∫•u h√¨nh m·∫≠t kh·∫©u: Ubuntu@123456
          mkdir -p ~/.config/code-server
          cat <<EOF > ~/.config/code-server/config.yaml
          bind-addr: 127.0.0.1:8080
          auth: password
          password: Ubuntu@123456
          cert: false
          EOF

          # 4. Ch·∫°y VS Code Web h∆∞·ªõng v√†o ·ªï c·ª©ng Zun
          nohup code-server --user-data-dir $HOME/Zun/vscode-data $HOME/Zun > /dev/null 2>&1 &

          # 5. T·∫£i v√† ch·∫°y Kami Tunnel (Port 8080)
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz
          chmod +x kami-tunnel
          ./kami-tunnel 8080 > /dev/null 2>&1 &

      - name: üéâ TH√îNG TIN TRUY C·∫¨P VS CODE (ZUNADMIN)
        run: |
          echo "üîÑ ƒêang l·∫•y li√™n k·∫øt t·ª´ Zun x Kami Tunnel..."
          while [ ! -f kami_tunnel.txt ]; do sleep 2; done
          
          WEB_URL=""
          while [ -z "$WEB_URL" ]; do
            WEB_URL=$(cat kami_tunnel.txt)
            sleep 2
          done
          
          echo ""
          echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
          echo "‚îÇ        üöÄ VS CODE WEB IDX - HOST: ZUNADMIN         ‚îÇ"
          echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
          echo "‚îÇ üåê Li√™n k·∫øt Web: http://$WEB_URL"
          echo "‚îÇ üîê M·∫≠t kh·∫©u    : Ubuntu@123456"
          echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
          echo "‚îÇ üñ•Ô∏è  T√™n m√°y     : Zunadmin                          ‚îÇ"
          echo "‚îÇ üõ†Ô∏è  ·ªî c·ª©ng Zun  : 60GB (ƒê√£ bi·ªát l·∫≠p)               ‚îÇ"
          echo "‚îÇ üë§ Ng∆∞·ªùi t·∫°o   : Zun x Kami Tunnel                 ‚îÇ"
          echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
          echo ""
          echo "WEB_LINK=$WEB_URL" >> $GITHUB_ENV

      - name: ‚è≥ DUY TR√å PHI√äN ZUNADMIN
        run: |
          for i in {1..72}; do
            # Hi·ªÉn th·ªã log tr·∫°ng th√°i c·ª±c g·ªçn
            echo "üíé [$(date +%H:%M:%S)] Zunadmin ƒëang ch·∫°y. Link: $WEB_LINK"
            sleep 300
          done
