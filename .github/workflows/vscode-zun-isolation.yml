name: ğŸš€ Ubuntu IDE Web (Zun x Kami Tunnel)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  IDE-Setup:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ› ï¸ ÄANG CÃ€I Äáº¶T MÃ”I TRÆ¯á»œNG WEB IDE (VS CODE)
        run: |
          # 1. Tá»‘i Æ°u há»‡ thá»‘ng & áº©n log
          sudo rm -rf /var/lib/dpkg/lock-frontend > /dev/null 2>&1
          sudo apt-get update > /dev/null 2>&1
          
          # 2. CÃ i Ä‘áº·t giao diá»‡n & RDP
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y xfce4 xfce4-goodies xrdp > /dev/null 2>&1
          
          # 3. CÃ i Ä‘áº·t Visual Studio Code & Web Tools (Node.js, Git)
          sudo apt-get install -y software-properties-common apt-transport-https wget git > /dev/null 2>&1
          wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add - > /dev/null 2>&1
          sudo add-apt-repository "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main" -y > /dev/null 2>&1
          sudo apt-get install -y code > /dev/null 2>&1
          
          # CÃ i Node.js má»›i nháº¥t cho Web Dev
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - > /dev/null 2>&1
          sudo apt-get install -y nodejs > /dev/null 2>&1
          
          # 4. Cáº¥u hÃ¬nh User: ubuntu | Pass: Ubuntu@123456
          sudo userdel -r ubuntu > /dev/null 2>&1
          sudo useradd -m -s /bin/bash ubuntu
          echo "ubuntu:Ubuntu@123456" | sudo chpasswd
          sudo usermod -aG sudo ubuntu
          
          # Cáº¥u hÃ¬nh khá»Ÿi Ä‘á»™ng XFCE
          echo "xfce4-session" > /home/ubuntu/.xsession
          sudo chown ubuntu:ubuntu /home/ubuntu/.xsession
          sudo systemctl restart xrdp > /dev/null 2>&1
          
          # 5. Cháº¡y Kami Tunnel (Port 3389)
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz
          chmod +x kami-tunnel
          ./kami-tunnel 3389 > /dev/null 2>&1 &

      - name: ğŸ‰ THÃ”NG TIN Káº¾T Ná»I IDE
        run: |
          echo "ğŸ”„ Äang láº¥y IP tá»« Zun x Kami Tunnel..."
          while [ ! -f kami_tunnel.txt ]; do sleep 2; done
          RDP_IP=$(cat kami_tunnel.txt)
          
          echo ""
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚        ğŸš€ UBUNTU WEB IDE READY (VS CODE)           â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ ğŸ› ï¸  CÃ´ng cá»¥: VS Code, Node.js, Git, XFCE           â”‚"
          echo "â”‚ ğŸŒ Äá»‹a chá»‰ IP  : $RDP_IP"
          echo "â”‚ ğŸ‘¤ TÃ i khoáº£n   : ubuntu"
          echo "â”‚ ğŸ” Máº­t kháº©u    : Ubuntu@123456"
          echo "â”‚ ğŸ“ Cá»•ng RDP    : 3389"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ âš¡ NgÆ°á»i táº¡o: Zun | Cáº¥u hÃ¬nh: 4 CPU / 8GB RAM      â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          echo ""
          echo "IP_ADDR=$RDP_IP" >> $GITHUB_ENV

      - name: â³ DUY TRÃŒ PHIÃŠN
        run: |
          for i in {1..72}; do
            echo "ğŸ’ [$(date +%H:%M:%S)] IDE Ä‘ang cháº¡y. IP: $IP_ADDR"
            sleep 300
          done
