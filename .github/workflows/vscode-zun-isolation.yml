name: üöÄ VS CODE WEB IDX (ZUN ADMIN VIP)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian s·ª≠ d·ª•ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h'
        - '5h40m'

jobs:
  VSCode-ZunAdmin:
    runs-on: ubuntu-latest
    steps:
      - name: üõ†Ô∏è KH·ªûI T·∫†O H·ªÜ TH·ªêNG ZUN (ISOLATED)
        run: |
          # 1. Thi·∫øt l·∫≠p Hostname
          sudo hostnamectl set-hostname ZunAdmin
          
          # 2. T·∫°o User Admin bi·ªát l·∫≠p
          echo "üë§ ƒêang thi·∫øt l·∫≠p ng∆∞·ªùi d√πng Admin..."
          sudo useradd -m -s /bin/bash Admin
          echo "Admin:Ubuntu@123456" | sudo chpasswd
          sudo usermod -aG sudo Admin

          # 3. T·∫°o ·ªï c·ª©ng 60GB v√† Mount v√†o Home
          echo "üíø ƒêang t·∫°o ph√¢n v√πng 60GB ri√™ng bi·ªát..."
          sudo fallocate -l 60G /mnt/zun_storage.img
          sudo mkfs.ext4 /mnt/zun_storage.img > /dev/null 2>&1
          sudo mount -o loop /mnt/zun_storage.img /home/Admin
          
          # ƒê·∫£m b·∫£o quy·ªÅn s·ªü h·ªØu cho Admin
          sudo chown -R Admin:Admin /home/Admin
          sudo chmod 755 /home/Admin
          sudo cp /etc/skel/.bashrc /home/Admin/
          sudo chown Admin:Admin /home/Admin/.bashrc

          # 4. C√†i ƒë·∫∑t VS Code Server
          echo "üì• ƒêang t·∫£i VS Code Web..."
          curl -fsSL https://code-server.dev/install.sh | sh > /dev/null 2>&1

          # 5. C·∫•u h√¨nh Code-Server & Fake Storage View (Fix l·ªói EOF)
          sudo -u Admin mkdir -p /home/Admin/.config/code-server
          sudo -u Admin bash -c "cat <<EOF > /home/Admin/.config/code-server/config.yaml
          bind-addr: 127.0.0.1:8080
          auth: password
          password: Ubuntu@123456
          cert: false
          EOF"

          # Fix l·ªánh df ƒë·ªÉ ch·ªâ hi·ªán ·ªï 60GB (D√πng d·∫•u tho√°t chu·ªói chu·∫©n)
          sudo -u Admin bash -c "echo \"alias df='df -h | grep -E \"Filesystem|/home/Admin\"'\" >> /home/Admin/.bashrc"

          # 6. Ch·∫°y VS Code & Tunnel
          echo "üöÄ Kh·ªüi ƒë·ªông d·ªãch v·ª•..."
          sudo -u Admin nohup code-server > /home/Admin/code.log 2>&1 &
          
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz
          chmod +x kami-tunnel
          ./kami-tunnel 8080 > kami_tunnel.txt 2>&1 &

      - name: üéâ B·∫¢NG ƒêI·ªÄU KHI·ªÇN ZUN ADMIN
        run: |
          echo "üîÑ ƒêang k·∫øt n·ªëi Tunnel..."
          sleep 7
          WEB_URL=$(grep -o 'http://[a-zA-Z0-9.-]*' kami_tunnel.txt | head -n 1)
          
          while [ -z "$WEB_URL" ]; do
            sleep 2
            WEB_URL=$(grep -o 'http://[a-zA-Z0-9.-]*' kami_tunnel.txt | head -n 1)
          done

          # GIAO DI·ªÜN LOG M·ªöI SI√äU ƒê·∫∏P
          echo -e "\033[1;32m"
          echo "  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó"
          echo "  ‚ïö‚ïê‚ïê‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë"
          echo "    ‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë"
          echo "   ‚ñà‚ñà‚ñà‚ïî‚ïù  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë"
          echo "  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë"
          echo "  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù    ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù"
          echo -e "\033[0m"
          echo -e "\033[1;34m‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\033[0m"
          echo -e "\033[1;34m‚ïë\033[0m \033[1;32müåê LINK TRUY C·∫¨P :\033[0m \033[4;37m$WEB_URL\033[0m"
          echo -e "\033[1;34m‚ïë\033[0m \033[1;32müë§ USERNAME     :\033[0m Admin"
          echo -e "\033[1;34m‚ïë\033[0m \033[1;32müîê PASSWORD     :\033[0m Ubuntu@123456"
          echo -e "\033[1;34m‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\033[0m"
          echo -e "\033[1;34m‚ïë\033[0m \033[1;33müíæ STORAGE      :\033[0m 60GB (ƒê√£ bi·ªát l·∫≠p ho√†n to√†n)        \033[1;34m‚ïë\033[0m"
          echo -e "\033[1;34m‚ïë\033[0m \033[1;33müõ°Ô∏è ISOLATION    :\033[0m Enabled (User Admin Mode)           \033[1;34m‚ïë\033[0m"
          echo -e "\033[1;34m‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\033[0m"
          echo ""
          echo "WEB_LINK=$WEB_URL" >> $GITHUB_ENV

      - name: ‚è≥ DUY TR√å TR·∫†NG TH√ÅI
        run: |
          echo -e "\033[1;32m[$(date +%T)] H·ªá th·ªëng ZunAdmin ƒë√£ s·∫µn s√†ng ph·ª•c v·ª•!\033[0m"
          for i in {1..72}; do
            echo -e "\033[1;34müíé [$(date +%T)] ƒêang ch·∫°y t·∫°i: $WEB_LINK\033[0m"
            sleep 300
          done
