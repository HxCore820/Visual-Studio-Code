name: ğŸš€ VS Code Web IDX (Zun Isolation)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
          - '1h'
          - '3h'
          - '5h40m'

jobs:
  Zun-Isolation:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: ğŸ› ï¸ KHá»I Táº O MÃ”I TRÆ¯á»œNG ZUNADMIN
        run: |
          set -e

          echo "ğŸš€ [ZUN] Khá»Ÿi táº¡o hostname..."
          sudo hostnamectl set-hostname Zunadmin
          echo "127.0.0.1 Zunadmin" | sudo tee -a /etc/hosts > /dev/null

          echo "ğŸ’¾ [ZUN] Táº¡o á»• cá»©ng áº£o 60GB (ZunDisk)..."
          fallocate -l 60G $HOME/zun_disk.img
          mkfs.ext4 -F $HOME/zun_disk.img > /dev/null
          mkdir -p $HOME/ZunDisk
          sudo mount -o loop $HOME/zun_disk.img $HOME/ZunDisk
          sudo chown -R $USER:$USER $HOME/ZunDisk

          echo "ğŸ‘¤ [ZUN] Táº¡o user Admin..."
          sudo useradd -m -s /bin/bash Admin || true
          echo "Admin ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/Admin
          sudo mkdir -p /home/Admin
          sudo chown -R Admin:Admin /home/Admin

          echo "ğŸ§  [ZUN] CÃ i VS Code Web (code-server)..."
          curl -fsSL https://code-server.dev/install.sh | sh > /dev/null

          sudo -u Admin mkdir -p /home/Admin/.config/code-server
          sudo -u Admin cat <<EOF > /home/Admin/.config/code-server/config.yaml
          bind-addr: 127.0.0.1:8080
          auth: password
          password: Ubuntu@123456
          cert: false
          EOF

          echo "â–¶ï¸ [ZUN] Khá»Ÿi cháº¡y VS Code Web trong á»• 60GB..."
          sudo -u Admin nohup code-server \
            --user-data-dir $HOME/ZunDisk/vscode-data \
            $HOME/ZunDisk \
            > /dev/null 2>&1 &

          echo "ğŸŒ [ZUN] Táº£i & cháº¡y Kami Tunnel..."
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz
          chmod +x kami-tunnel
          nohup ./kami-tunnel 8080 > /dev/null 2>&1 &

      - name: ğŸ‰ THÃ”NG TIN TRUY Cáº¬P VS CODE
        run: |
          echo "ğŸ”„ [ZUN] Äang láº¥y link truy cáº­p..."
          while [ ! -f kami_tunnel.txt ]; do sleep 2; done

          WEB_URL=$(cat kami_tunnel.txt)

          echo ""
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚ ğŸš€ VS CODE WEB - ZUN ISOLATION               â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ ğŸŒ Link      : http://$WEB_URL               â”‚"
          echo "â”‚ ğŸ” Password  : Ubuntu@123456                 â”‚"
          echo "â”‚ ğŸ‘¤ User      : Admin                         â”‚"
          echo "â”‚ ğŸ’¾ Disk      : 60GB (ZunDisk - Isolated)     â”‚"
          echo "â”‚ ğŸ–¥ï¸ Hostname  : Zunadmin                      â”‚"
          echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
          echo "â”‚ âš ï¸ LÆ°u Ã½: Chá»‰ tháº¥y á»• 60GB trong VS Code     â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          echo ""

          echo "WEB_LINK=$WEB_URL" >> $GITHUB_ENV

      - name: â³ DUY TRÃŒ PHIÃŠN ZUNADMIN
        run: |
          for i in {1..72}; do
            echo "ğŸ’ [$(date +%H:%M:%S)] Zunadmin Ä‘ang cháº¡y | $WEB_LINK"
            sleep 300
          done
