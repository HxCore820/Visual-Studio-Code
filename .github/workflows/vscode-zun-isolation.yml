name: ğŸš€ VS CODE WEB IDX (ZUN ADMIN STABLE)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h'
        - '5h40m'

jobs:
  VSCode-ZunAdmin:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ› ï¸ KHá»I Táº O Há»† THá»NG BIá»†T Láº¬P
        run: |
          # 1. Thiáº¿t láº­p Hostname & User
          sudo hostnamectl set-hostname ZunAdmin
          sudo useradd -m -s /bin/bash Admin
          echo "Admin:Ubuntu@123456" | sudo chpasswd
          sudo usermod -aG sudo Admin

          # 2. Táº¡o á»• cá»©ng áº£o 60GB
          sudo fallocate -l 60G /mnt/zun_storage.img
          sudo mkfs.ext4 /mnt/zun_storage.img > /dev/null 2>&1
          
          # 3. Mount vÃ  Cáº¥u hÃ¬nh (Äáº£m báº£o thÆ° má»¥c tá»“n táº¡i)
          sudo mount -o loop /mnt/zun_storage.img /home/Admin
          sudo mkdir -p /home/Admin/.config/code-server
          sudo cp /etc/skel/.bashrc /home/Admin/
          sudo chown -R Admin:Admin /home/Admin
          sudo chmod 755 /home/Admin

          # 4. CÃ i Ä‘áº·t VS Code Web
          curl -fsSL https://code-server.dev/install.sh | sh > /dev/null 2>&1

          # 5. Cáº¥u hÃ¬nh Code-Server
          sudo -u Admin bash -c "cat <<EOF > /home/Admin/.config/code-server/config.yaml
          bind-addr: 127.0.0.1:8080
          auth: password
          password: Ubuntu@123456
          cert: false
          EOF"

          # Alias df -h (Chá»‰ hiá»‡n á»• Admin)
          echo "alias df='df -h | grep -E \"Filesystem|/home/Admin\"'" | sudo tee -a /home/Admin/.bashrc > /dev/null

          # 6. Khá»Ÿi cháº¡y VS Code (Cháº¡y ngáº§m)
          sudo -u Admin nohup code-server > /home/Admin/code_server.log 2>&1 &
          
          # 7. Táº£i vÃ  Cháº¡y Tunnel (Sá»­ dá»¥ng stdbuf Ä‘á»ƒ ghi log liÃªn tá»¥c)
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz
          chmod +x kami-tunnel
          
          # Cháº¡y ngáº§m vÃ  Ã©p ghi log vÃ o file ngay láº­p tá»©c
          stdbuf -oL ./kami-tunnel 8080 > kami_tunnel.txt 2>&1 &

      - name: ğŸ‰ Báº¢NG ÄIá»€U KHIá»‚N ZUN ADMIN
        run: |
          echo "ğŸ”„ Äang trÃ­ch xuáº¥t liÃªn káº¿t tá»« Tunnel..."
          sleep 15 # TÄƒng thá»i gian chá» Ä‘á»ƒ tunnel á»•n Ä‘á»‹nh
          
          # Äá»c file an toÃ n: Lá»c sáº¡ch kÃ½ tá»± mÃ u ANSI vÃ  láº¥y link http
          # DÃ¹ng sed Ä‘á»ƒ xÃ³a mÃ£ mÃ u \x1b...
          WEB_URL=$(sed -r "s/\x1B\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]//g" kami_tunnel.txt | grep -o 'http://[a-zA-Z0-9.-]*:[0-9]*' | head -n 1)
          
          while [ -z "$WEB_URL" ]; do
            echo "âŒ› Äang quÃ©t láº¡i file log..."
            sleep 5
            WEB_URL=$(sed -r "s/\x1B\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]//g" kami_tunnel.txt | grep -o 'http://[a-zA-Z0-9.-]*:[0-9]*' | head -n 1)
          done

          # LOG GIAO DIá»†N VIP
          echo -e "\033[1;32m"
          echo "  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—"
          echo "  â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘"
          echo "    â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘"
          echo "   â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘"
          echo "  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘"
          echo -e "\033[0m"
          echo -e "\033[1;34mâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\033[0m"
          echo -e "\033[1;34mâ”‚\033[0m \033[1;32mğŸŒ LINK TRUY Cáº¬P :\033[0m \033[4;32m$WEB_URL\033[0m"
          echo -e "\033[1;34mâ”‚\033[0m \033[1;32mğŸ‘¤ USERNAME     :\033[0m \033[1;37mAdmin\033[0m"
          echo -e "\033[1;34mâ”‚\033[0m \033[1;32mğŸ” PASSWORD     :\033[0m \033[1;37mUbuntu@123456\033[0m"
          echo -e "\033[1;34mâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\033[0m"
          echo -e "\033[1;34mâ”‚\033[0m \033[1;33mğŸ’¾ STORAGE      :\033[0m 60GB (Biá»‡t láº­p - /home/Admin)       \033[1;34mâ”‚\033[0m"
          echo -e "\033[1;34mâ”‚\033[0m \033[1;33mğŸ›¡ï¸ STATUS       :\033[0m Online - Isolated Admin Mode         \033[1;34mâ”‚\033[0m"
          echo -e "\033[1;34mâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\033[0m"
          echo ""
          echo "WEB_LINK=$WEB_URL" >> $GITHUB_ENV

      - name: â³ DUY TRÃŒ Káº¾T Ná»I
        run: |
          echo -e "\033[1;32mâœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng!\033[0m"
          for i in {1..100}; do
            echo -e "\033[1;36mğŸ’ [$(date +%T)] Hoáº¡t Ä‘á»™ng táº¡i: $WEB_LINK\033[0m"
            sleep 300
          done
